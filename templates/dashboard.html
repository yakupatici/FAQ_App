{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="mb-3">
                <i class="fas fa-search me-2 text-primary"></i>
                IT Destek Merkezi
                {% if search %}
                <small class="text-muted fs-6">
                    "{{ search }}" için arama sonuçları
                </small>
                {% endif %}
            </h2>
            <div class="card">
                <div class="card-body">
                    <form class="d-flex gap-2" method="GET" action="{{ url_for('dashboard') }}">
                        <input type="search" name="search" class="form-control form-control-lg" 
                               placeholder="Sorunuzu yazın veya anahtar kelime arayın..." 
                               value="{{ search if search else '' }}">
                        <button class="btn btn-primary px-4" type="submit">
                            <i class="fas fa-search me-2"></i>Ara
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-headset me-2"></i>
                        Acil Destek
                    </h5>
                    <p class="card-text">7/24 IT Destek Hattı</p>
                    <p class="h4 text-primary">(0232) 123-4567</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>
                    <i class="fas fa-folder me-2 text-primary"></i>
                    Kategoriler
                </h3>
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-primary active" data-filter="all">
                        Tümü
                    </button>
                    <button type="button" class="btn btn-outline-primary" data-filter="pc">
                        Bilgisayar
                    </button>
                    <button type="button" class="btn btn-outline-primary" data-filter="network">
                        Ağ
                    </button>
                    <button type="button" class="btn btn-outline-primary" data-filter="printer">
                        Yazıcı
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        {% if faqs %}
            {% for faq in faqs %}
            <div class="col-md-6 faq-item" data-category="{{ faq.category.lower() }}">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            {% if faq.category.lower() == 'pc' %}
                                <i class="fas fa-desktop me-2 text-primary"></i>
                            {% elif faq.category.lower() == 'printer' %}
                                <i class="fas fa-print me-2 text-success"></i>
                            {% elif faq.category.lower() == 'network' %}
                                <i class="fas fa-network-wired me-2 text-info"></i>
                            {% else %}
                                <i class="fas fa-cog me-2 text-secondary"></i>
                            {% endif %}
                            {{ faq.question }}
                        </h5>
                        <span class="badge bg-primary">{{ faq.category }}</span>
                    </div>
                    <div class="card-body">
                        <p class="card-text">{{ faq.answer }}</p>
                        {% if current_user.role == 'admin' %}
                        <div class="mt-3 pt-3 border-top">
                            <div class="btn-group">
                                <a href="{{ url_for('edit_faq_form', faq_id=faq.id) }}" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit me-1"></i>Düzenle
                                </a>
                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                        onclick="deleteFAQ({{ faq.id }})">
                                    <i class="fas fa-trash-alt me-1"></i>Sil
                                </button>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="card-footer bg-light">
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>
                            Son güncelleme: {{ faq.updated_at.strftime('%d.%m.%Y %H:%M') }}
                        </small>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="col-12">
                <div class="alert alert-info">
                    {% if search %}
                        <h4 class="alert-heading mb-3">
                            <i class="fas fa-info-circle me-2"></i>
                            Sonuç Bulunamadı
                        </h4>
                        <p class="mb-0">
                            "{{ search }}" araması için sonuç bulunamadı. 
                            Lütfen farklı anahtar kelimeler kullanarak tekrar deneyin.
                        </p>
                    {% else %}
                        <h4 class="alert-heading mb-3">
                            <i class="fas fa-info-circle me-2"></i>
                            Henüz SSS Bulunmuyor
                        </h4>
                        <p class="mb-0">
                            Sistemde henüz hiç Sık Sorulan Soru bulunmuyor. 
                            {% if current_user.role == 'admin' %}
                            <a href="{{ url_for('add_faq') }}" class="alert-link">Yeni SSS eklemek için tıklayın</a>.
                            {% endif %}
                        </p>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>

    {% if current_user.role == 'admin' %}
    <div class="row mt-5">
        <div class="col-12 text-center">
            <a href="{{ url_for('add_faq') }}" class="btn btn-primary btn-lg">
                <i class="fas fa-plus-circle me-2"></i>Yeni SSS Ekle
            </a>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Kategori filtreleme
    const filterButtons = document.querySelectorAll('[data-filter]');
    const faqItems = document.querySelectorAll('.faq-item');

    filterButtons.forEach(button => {
        button.addEventListener('click', () => {
            const filter = button.getAttribute('data-filter');
            
            // Buton aktifliğini güncelle
            filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            // FAQları filtrele
            faqItems.forEach(item => {
                if (filter === 'all' || item.getAttribute('data-category') === filter) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
});

// FAQ silme fonksiyonu
function deleteFAQ(faqId) {
    if (confirm('Bu SSS\'yi silmek istediğinizden emin misiniz?')) {
        // Gizli form oluştur
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/delete-faq/' + faqId;
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %} 